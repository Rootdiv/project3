(()=>{"use strict";const e=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=document.getElementById("modal-kit"),r=document.getElementById("modal"),l=window.pageYOffset;if(0===l){var o=document.getElementById("modal");o.style.top="20%"}else{var i=document.getElementById("modal");i.style.top=l+40+"px"}var s=e.getAttribute("data-id"),u=t+"/components/modal.php?id="+s+n;fetch(u).then((function(e){if(200!==e.status)throw new Error("Status network not 200");return e.text()})).then((function(e){a.style.display="block",r.innerHTML=e})).catch((function(e){return console.error(e)})),a&&document.addEventListener("keydown",(function(e){"Escape"===e.code&&(a.style.display="none")}))},t=function(){var e=document.querySelector(".pass");e&&e.addEventListener("click",(function(e){var t=e.target;if(t.matches(".pass-control")){var n=t.previousElementSibling;"password"===n.getAttribute("type")?(t.classList.add("view"),n.setAttribute("type","text")):(t.classList.remove("view"),n.setAttribute("type","password"))}}))};var n;(function(){var e=document.querySelector(".go-top");window.addEventListener("scroll",(function(){var t=Math.round(window.scrollY);e.style.opacity=t>300?1:0}));var t=function e(){window.pageYOffset>0&&(window.scrollBy(0,-10),setTimeout(e,1))};e.addEventListener("click",(function(){t()}))})(),document.querySelector(".logo-mobile").addEventListener("click",(function(){document.querySelector(".menu-mobile").classList.toggle("menu-mobile-hidden")})),(n=document.querySelector(".catalog-sort"))&&n.addEventListener("click",(function(e){var t=e.target;if(t.closest(".categories")){var n=t.closest(".categories");n.querySelector(".categories-items").classList.toggle("hidden"),n.querySelector(".categories-img").classList.toggle("categories-img-inv")}else if(t.closest(".size")){var a=t.closest(".size");a.querySelector(".size-items").classList.toggle("hidden"),a.querySelector(".size-img").classList.toggle("size-img-inv")}else if(t.closest(".prices")){var r=t.closest(".prices");r.querySelector(".prices-items").classList.toggle("hidden"),r.querySelector(".prices-img").classList.toggle("size-img-inv")}})),function(){var t=document.querySelector(".basket-block"),n=document.getElementById("basket"),a=document.getElementById("basket-amount"),r=document.getElementById("delivery-set"),l=document.getElementById("div-total"),o=document.getElementById("total"),i=document.getElementById("cost"),s=document.getElementById("div-amount"),u=document.getElementById("delivery_sum"),c=document.getElementById("basket-set"),d=document.getElementById("modal-kit");if(t){var v=function(){s.textContent=a.value+" руб.",i.textContent=s.textContent;var e=parseInt(a.value)+parseInt(r.value);l.textContent=e+" руб.",o.setAttribute("value",e),u.textContent=r.value+" руб."},m=function(){var e=0;n.querySelectorAll(".quantity").forEach((function(t){e++,t.setAttribute("id","quantity"+e)}));var t=0;n.querySelectorAll(".price").forEach((function(e){t++,e.setAttribute("id","price"+t)}))},g=function(){for(var e=n.getElementsByClassName("quantity"),t=0,r=1;r<=e.length;r++){var l="quantity"+r,o=document.getElementById(l).value;if(""===o||o<1||o>50)alert("Количество не может быть меньше 1 или быть больше 50"),location.reload();else{var i=document.getElementById(l).getAttribute("data-price"),s=parseInt(o)*parseInt(i),u="price"+r;document.getElementById(u).textContent=s+" руб.",t+=parseInt(s)}}a.setAttribute("value",t),v()};u.textContent=r.value+" руб.",r.addEventListener("change",(function(){u.textContent=r.value+" руб.","0"!==a.value&&v()})),"0"!==a.value&&(s.removeAttribute("style"),l.removeAttribute("style"),document.querySelector("button").removeAttribute("disabled"),m(),v()),t.addEventListener("click",(function(e){var t=e.target;t.matches(".number-plus")?t.nextElementSibling.value++:t.matches(".number-minus")?t.previousElementSibling.value--:t.closest("#remove")?(e.preventDefault(),function(e){var t=e.getAttribute("href"),a=t.split("=").pop(),r=c.innerHTML.split("(");fetch(t).then((function(e){if(200!==e.status)throw new Error("Status network not 200");document.getElementById(a).remove();var t=parseInt(r[1])-1;0!==t?(c.innerHTML=r[0]+"("+t+")",m(),g()):(c.innerHTML=r[0]+"(0)",n.innerHTML='<div class="box">Ваша корзина пуста</div>',s.style.visibility="hidden",location.reload())})).catch((function(e){return console.error(e)}))}(t)):t.matches(".modal-close")||t.closest("#modal")?d.style.display="none":"0"!==a.value&&(d.style.display="none",g())})),n.addEventListener("mouseover",(function(t){var n=t.target;if(n.closest(".product-photo")&&1!=("ontouchstart"in window||"onmsgesturechange"in window)){var a=location.href.substring(0,location.href.lastIndexOf("/"));e(n.closest(".product-photo"),a)}}))}}(),function(){var e=document.createElement("div");e.textContent="Ошибка в этом поле",e.classList.add("msg-error","size-font"),e.style.textTransform="none";var t=function(t){t.previousElementSibling&&t.previousElementSibling.classList.contains("error")&&t.previousElementSibling.remove(),t.insertAdjacentElement("beforebegin",e)},n=function(n){var a=n.target;a.value=a.value.replace(/[^а-яё\s-]/gi,""),a.value.length>50?t(a):e.remove()},a=function(e){var t=e.target;t.matches('[name="title"]')?t.value=t.value.charAt(0).toUpperCase()+t.value.slice(1).toLowerCase():t.value=t.value.split(/\s+/).map((function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()})).join(" ").trim(),(t.value.length<2||t.value.length>50)&&(t.value="")},r=function(n){var a=n.target;a.value=a.value.replace(/[^а-яё\d\s\-.]/gi,""),a.value.length>100?t(a):e.remove()},l=function(e){var t=e.target;(t.value.length<2||t.value.length>100)&&(t.value="")},o=function(t){var n=t.target;n.value=n.value.replace(/[^\w\d\-._@]/gi,""),e.remove()},i=function(n){var a=n.target;a.value=a.value.replace(/^[\s-]+|[\s-]+$/gi,"").replace(/-+/g,"-"),/^[a-z0-9_.-]+@[a-z0-9-]+\.[a-z]{2,6}$/i.test(a.value)&&""!==a.value.trim()?e.remove():a.closest('[name="scribe"]')?(e.className="msg-error box",e.textContent="Некорректный e-mail. Попробуйте ещё раз",a.closest('[name="scribe"]').insertAdjacentElement("beforeend",e)):t(a)},s=function(n){var a=n.target;a.matches('[name="description"]')?a.value=a.value.replace(/[^а-яё\-.,!\s]/gi,""):a.value=a.value.replace(/[a-z$[\]*{}]/gi,""),a.value.length>2e3?t(a):e.remove()},u=function(n){var a=n.target;a.value=a.value.trim().replace(/\s+/g," ").replace(/-+/g,"-"),a.value.length<15||a.value.length>2e3?t(a):e.remove()},c=function(e){var t=e.target;t.value=t.value.replace(/[^\d]/gi,""),t.value.length>6&&(t.value=t.value.substring(0,6))},d=function(n){var a=n.target;6!==a.value.length?t(a):e.remove()},v=function(e){var t=e.target;t.value=t.value.replace(/[^\d]/gi,""),t.value.length>20&&(t.value=t.value.substring(0,20))},m=function(e){var t=e.target;(t.value.length<2||t.value.length>20)&&(t.value="")},g=function(t){var n=t.target;n.value=n.value.replace(/[^+\d]/g,""),n.value.length>12?n.value=n.value.substring(0,12):"+"===n.value.charAt(0)&&"7"===n.value.charAt(1)||(n.value="+7"),e.remove()},p=function(n){var a=n.target;a.value=a.value.replace(/^[+]{1,}/g,"+").replace(/[+]{1,}$/g,""),/[+]{1}[0-9]{12}/g.test(a.value)?t(a):e.remove()},f=function(t){var n=t.target;n.value=n.value.replace(/[^\w\d\-._@]/gi,""),-1!==n.value.indexOf("@")?n.value.length>50&&(n.value=n.value.substring(0,50)):n.value.length>15&&(n.value=n.value.substring(0,15)),e.remove()},y=function(n){var a=n.target;a.value=a.value.replace(/^[\s-]+|[\s-]+$/gi,"").replace(/-+/g,"-"),-1!==a.value.indexOf("@")?/^[a-z0-9_.-]+@[a-z0-9-]+\.[a-z]{2,6}$/i.test(a.value)&&""!==a.value.trim()?e.remove():t(a):(a.value.length<4||a.value.length>15)&&(a.value="")},h=function(e){var t=e.target;t.value=t.value.replace(/[^\w\-+#%!]$/gi,""),t.value.length>17&&(t.value=t.value.substring(0,17))},b=function(e){var t=e.target;(t.value.length<5||t.value.length>17)&&(t.value="")},E=function(n){var a=n.target;if(""!==a.value){var r=a.value.split("\\"),l=r[r.length-1],o=a.value.split(".").pop(),i=a.files[0].size;/^[a-z0-9_.-]+$/i.test(l)&&["jpg","png","jpeg"].includes(o)?i<22600||i>5242880?t(a):e.remove():t(a)}};document.body.addEventListener("click",(function(e){var t=e.target;t.matches('[name*="name"]')||t.matches('[name="city"]')||t.matches('[name="full_name"]')||t.matches('[name="title"]')?(t.addEventListener("input",n),t.addEventListener("blur",a)):t.matches('[name="address"]')?(t.addEventListener("input",r),t.addEventListener("blur",l)):t.matches('[type="email"]')?(t.addEventListener("input",o),t.addEventListener("blur",i)):t.matches('[placeholder*="сообщение"]')||t.matches('[name="description"]')?(t.addEventListener("input",s),t.addEventListener("blur",u)):t.matches('[name="postcode"]')?(t.addEventListener("input",c),t.addEventListener("blur",d)):t.matches('[type="tel"]')?(t.addEventListener("input",g),t.addEventListener("blur",p)):t.matches('[name="login"]')?(t.addEventListener("input",f),t.addEventListener("blur",y)):t.matches('[name="password"]')?(t.addEventListener("input",h),t.addEventListener("blur",b)):t.matches('[name="article"]')||t.matches('[name="price"]')||t.matches('[name="sized"]')?(t.addEventListener("input",v),t.addEventListener("blur",m)):t.matches('[type="file"]')&&t.addEventListener("input",E)}))}(),function(){var e=location.href.substring(0,location.href.lastIndexOf("/project3/")),t='<img src="'.concat(e,'/project3/img/loader.svg" alt="Загрузка..."/>'),n=document.createElement("div");n.classList.add("msg","size-font","box");var a=function(e){e.querySelector("button").insertAdjacentElement("afterend",n),n.innerHTML=t;var a=new FormData(e),r=function(){setTimeout((function(){n.remove(),n.classList.add("msg"),n.classList.remove("msg-error")}),5e3)},l=function(e){n.classList.remove("msg"),n.classList.add("msg-error"),n.textContent=e};(function(e,t){return fetch(t.action,{method:"POST",body:e})})(a,e).then((function(e){if(200!==e.status)throw new Error("Status network not 200");return e.text()})).then((function(t){if(t.includes("успешно"))e.matches('[name="scribe"]')?(e.reset(),n.textContent="Вы подписаны"):e.matches('[name="profile"]')||e.matches('[id="edit"]')||e.matches('[name="users"]')?(n.textContent=t,setTimeout((function(){return location.reload()}),2e3)):(l(t),setTimeout((function(){return location.reload()}),4e3)),r();else if(t.includes("Новый"))n.textContent=t+" успешно",setTimeout((function(){return location.reload()}),5500),r();else if(t.includes("Сообщение"))e.reset(),n.textContent=t,r();else if(t.includes("Авторизован")){var a=location.href.substring(0,location.href.lastIndexOf("/auth/")+1);location.replace(a+"main.php")}else t.includes("Зарегистрирован")||t.includes("сгенерирован")?(e.reset(),n.textContent=t,setTimeout((function(){var e=location.href.substring(0,location.href.lastIndexOf("/")+1);location.replace(e+"login.php")}),2500)):t.includes("Заказ")?(n.textContent=t,setTimeout((function(){return location.reload()}),2500)):t.includes("Удалено")?setTimeout((function(){return location.reload()}),500):t.includes("not found")||t.includes("Подключение")?(l("Ой, что-то пошло не так."),r()):(t.includes("Ошибка"),l(t),r())})).catch((function(e){l("Что-то пошло не так..."),console.error(e),r()}))},r=function(e){var t=e.value;return!(!/^[0-9]+$/g.test(t)||"0"===t)||(alert("Ошибка"),location.reload(),!1)};document.body.addEventListener("submit",(function(e){e.preventDefault();var t=e.target;t.querySelector(".msg-error")||(t.closest('[name="scribe"]')?r(t.querySelector("input[hidden]"))&&""!==t.querySelector('[type="email"]').value.trim()&&a(t):t.closest('[name="basket"]')?(function(e){var t=e.querySelector('[name="delivery"]');if(!/^[0-9]+$/g.test(t.value)||"0"===t.value)return alert("Ошибка! Значение изменено вручную!"),location.reload(),!1;if("500"!==t.value&&"250"!==t.value&&"1000"!==t.value)return alert("Ошибка! Значение изменено вручную!"),location.reload(),!1;var n=e.querySelector('[name="payment"]');/^[a-zа-я.\s]{4,20}$/i.test(n.value)&&""!==n.value||(alert("Ошибка! Значение изменено вручную!"),location.reload())}(t),""!==t.querySelector('[type="email"]').value.trim()&&""!==t.querySelector('[type="tel"]').value.trim()&&a(t)):t.closest('[name="contacts"]')?r(t.querySelector('[name="adm_msg"]'))&&""!==t.querySelector('[type="email"]').value.trim()&&""!==t.querySelector('[type="tel"]').value.trim()&&a(t):t.closest(".login")?""===t.querySelector('[name="login"]').value.trim()&&""===t.querySelector('[type="password"]').value.trim()||a(t):t.closest('[name="profile"]')?""===t.querySelector('[name="username"]').value.trim()&&""===t.querySelector('[type="email"]').value.trim()||a(t):t.closest('[name="order"]')?r(t.querySelector("input[hidden]"))&&a(t):t.closest('[id="edit"]')?r(t.querySelector('[name*="id"]'))&&r(t.querySelector('[name="category"]'))&&r(t.querySelector('[name="categories"]'))&&a(t):t.closest('[name="users"]')?r(t.querySelector('[name*="id"]'))&&r(t.querySelector('[name="id"]'))&&r(t.querySelector('[name="adm"]'))&&a(t):a(t))}))}(),t(),function(){var n=document.querySelector(".profile"),a=document.getElementById("modal-kit");if(n){var r=location.href.substring(0,location.href.lastIndexOf("/admin/"));n.addEventListener("click",(function(n){var l=n.target;l.matches(".products-edit")?e(l,r,"&product=edit"):l.matches(".products-new")?e(l,r,"&product=new"):l.matches(".users-edit")?(e(l,r,"&user=edit"),setTimeout(t,1e3)):(l.matches(".modal-close")||l.matches(".overlay"))&&(a.style.display="none")}))}}(),document.getElementById("map")&&window.ymaps.ready((function(){var e=new window.ymaps.Map("map",{center:[55.776142,37.648167],zoom:17},{searchControlProvider:"yandex#search"}),t=new window.ymaps.GeoObject({geometry:{type:"Point",coordinates:[55.776142,37.648167]}});e.geoObjects.add(t)}))})();